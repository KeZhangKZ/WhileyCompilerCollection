<project name="wycc" default="jarfile">  
  <import file="config.xml"/>

  <!-- ============================================== -->
  <!-- Build Commands -->
  <!-- ============================================== -->

  <target name="build">
    <javac debug="true" debuglevel="vars,lines,source" source="1.6" includeantruntime="true" classpath=""> 
      <src path="src"/>
      <include name="*/**"/>
      <exclude name="wycc/testing/**"/> 
      <exclude name="*/**/package-info.java"/> 
    </javac>
  </target>

  <target name="build-plugins">
    <subant failonerror="true" target="plugin">
      <property name="plugin.dir" value="${plugin.dir}"/>
      <fileset dir="plugins" includes="*/build.xml"/>
    </subant>
  </target>

  <!-- ============================================== -->
  <!-- Documenation --> 
  <!-- ============================================== -->

  <target name="doc">
    <javadoc
       destdir="docs/api"
       author="true"
       version="true"
       use="true"
       windowtitle="WyCC API">
      <doctitle><![CDATA[<h1>WyCC: The Whiley Compiler Collection (v${version})</h1>]]></doctitle>
      <bottom><![CDATA[<i>Copyright &#169; 2014 David J. Pearce. All Rights Reserved.</i>]]></bottom>
      <packageset dir="src">
	<include name="wycc/**"/>
	<exclude name="wycc/testing/**"/>
      </packageset>
      </javadoc>
  </target>

  <!-- ============================================== -->
  <!-- Distribution -->
  <!-- ============================================== -->

  <target name="jarfile" depends="build,build-plugins">
    <mkdir dir="lib"/>
    <mkdir dir="tmp"/>
    <manifest file="tmp/MANIFEST.MF">
      <attribute name="Built-By" value="${user.name}"/>
      <attribute name="Main-Class" value="wycc.Main"/>
    </manifest>    
    <jar destfile="lib/wycc-v${version}.jar" manifest="tmp/MANIFEST.MF">
      <fileset dir="src">
	<include name="wycc/**/*.class"/>
      </fileset>
    </jar>
    <delete dir="tmp"/>
    <echo message="============================================="/>
    <echo message="BUILT: lib/wycc-${version}.jar"/>
    <echo message="============================================="/>
  </target>

  <!-- ============================================== -->
  <!-- Misc Commands -->
  <!-- ============================================== -->

  <target name="clean">
    <delete includeEmptyDirs="true" failonerror="false">
      <fileset file="*~"/>
      <fileset dir="lib"/>
      <fileset dir="dist"/>
      <fileset dir="docs"/>
      <fileset dir="tests">
	<include name="**/*.class"/>
      </fileset>
    </delete>
  </target>

</project>
